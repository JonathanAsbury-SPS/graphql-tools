# Apollo Federation

`@graphql-tools/federation` package has utilities that can accept any service that implements [Apollo Federation Subgraph Specification](https://www.apollographql.com/docs/federation/federation-spec/).

## Example via URLs

```ts
import { getStitchedSchemaWithUrls } from '@graphql-tools/federation'

const urls = ['http://localhost:4001/graphql', 'http://localhost:4002/graphql', 'http://localhost:4003/graphql']

const gatewaySchema = stitchSchemas({
  subschemas: await Promise.all(urls.map(urls => getStitchedSchemaWithUrls({ url })))
})
```

## Example with local schemas

```ts
import { getSubschemaForFederationWithSchema } from '@graphql-tools/federation'
import { accountsSchema } from './accounts'
import { productsSchema } from './products'
import { reviewsSchema } from './reviews'

const serviceSchemas = [accountsSchema, productsSchema, reviewsSchema]

const gatewaySchema = stitchSchemas({
  subschemas: await Promise.all(serviceSchemas.map(schema => getSubschemaForFederationWithSchema({ schema })))
})
```

## Example with executors

```ts
import { getSubschemaForFederationWithExecutor } from '@graphql-tools/federation'
import { print } from 'graphql'
import { fetch } from '@whatwg-node/fetch'

function createExecutorByUrl(url: string) {
  return async ({ document, variables }) => {
    const query = print(document)
    const fetchResult = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, variables })
    })
    return fetchResult.json()
  }
}

const urls = ['http://localhost:4001/graphql', 'http://localhost:4002/graphql', 'http://localhost:4003/graphql']

const gatewaySchema = stitchSchemas({
  subschemas: await Promise.all(
    urls.map(url => getSubschemaForFederationWithExecutor({ executor: createExecutorByUrl(url) }))
  )
})
```
